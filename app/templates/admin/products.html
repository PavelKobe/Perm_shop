{% extends "admin/base.html" %}

{% block title %}–¢–æ–≤–∞—Ä—ã{% endblock %}
{% block page_title %}–¢–æ–≤–∞—Ä—ã{% endblock %}

{% block header_actions %}
<a href="/admin/products/add" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
{% endblock %}

{% block content %}
<div class="products-page">
  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="filters-bar">
    <form method="get" action="/admin/products" class="filters-form">
      <div class="filter-group">
        <label for="category_id">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
        <select name="category_id" id="category_id" onchange="this.form.submit()">
          <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
          {% for cat in categories %}
          <option value="{{ cat.id }}" {% if selected_category_id == cat.id %}selected{% endif %}>
            {{ cat.icon }} {{ cat.name }}
          </option>
          {% endfor %}
        </select>
      </div>
      
      {% if selected_category_id %}
      <div class="filter-group">
        <label for="subcategory_id">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
        <select name="subcategory_id" id="subcategory_id" onchange="this.form.submit()">
          <option value="">–í—Å–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
          {% for cat in categories if cat.id == selected_category_id %}
            {% for subcat in cat.subcategories %}
            <option value="{{ subcat.id }}" {% if selected_subcategory_id == subcat.id %}selected{% endif %}>
              {{ subcat.name }}
            </option>
            {% endfor %}
          {% endfor %}
        </select>
      </div>
      {% endif %}
      
      <div class="filter-group search-group">
        <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." value="{{ search }}">
        <button type="submit" class="btn btn-secondary">üîç</button>
      </div>
      
      <div class="filter-group">
        <label class="checkbox-inline">
          <input type="checkbox" name="show_deleted" value="1" {% if show_deleted %}checked{% endif %} onchange="this.form.submit()">
          –ü–æ–∫–∞–∑–∞—Ç—å —É–¥–∞–ª—ë–Ω–Ω—ã–µ
        </label>
      </div>
      
      {% if search or selected_category_id or show_deleted %}
      <a href="/admin/products" class="btn btn-outline">–°–±—Ä–æ—Å–∏—Ç—å</a>
      {% endif %}
    </form>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
  <div class="table-container">
    {% if products %}
    <table class="data-table">
      <thead>
        <tr>
          <th width="60">–§–æ—Ç–æ</th>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
          <th width="120">–¶–µ–Ω–∞</th>
          <th width="80">–°—Ç–∞—Ç—É—Å</th>
          <th width="100">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr>
          <td class="td-image">
            {% if product.image_url %}
            <img src="{{ product.image_url }}" alt="{{ product.name }}" class="table-image">
            {% else %}
            <div class="no-image">üì∑</div>
            {% endif %}
          </td>
          <td>
            <strong>{{ product.name }}</strong>
            <div class="badges">
              {% if product.is_new %}<span class="badge badge-new">–ù–æ–≤–∏–Ω–∫–∞</span>{% endif %}
              {% if product.old_price and product.old_price > product.price %}<span class="badge badge-sale">–°–∫–∏–¥–∫–∞</span>{% endif %}
              {% if product.is_featured %}<span class="badge badge-featured">–ê–∫—Ç—É–∞–ª—å–Ω—ã–π</span>{% endif %}
            </div>
          </td>
          <td>
            {% if product.subcategory %}
              <span class="category-path">
                {{ product.subcategory.category.icon }} {{ product.subcategory.category.name }}<br>
                <small>‚Ü≥ {{ product.subcategory.name }}</small>
              </span>
            {% else %}
              <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω–∞</span>
            {% endif %}
          </td>
          <td>
            <span class="price">{{ product.price | int }} ‚ÇΩ</span>
            {% if product.old_price %}
            <br><span class="old-price">{{ product.old_price | int }} ‚ÇΩ</span>
            {% endif %}
          </td>
          <td>
            {% if product.is_active %}
            <span class="status status-active">–ê–∫—Ç–∏–≤–µ–Ω</span>
            {% else %}
            <span class="status status-inactive">–£–¥–∞–ª—ë–Ω</span>
            {% endif %}
          </td>
          <td class="td-actions">
            <a href="/admin/products/edit/{{ product.id }}" class="btn btn-sm btn-secondary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
            {% if product.is_active %}
            <form method="post" action="/admin/products/delete/{{ product.id }}" style="display:inline" 
                  onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä ¬´{{ product.name }}¬ª?')">
              <button type="submit" class="btn btn-sm btn-danger" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
            </form>
            {% else %}
            <form method="post" action="/admin/products/restore/{{ product.id }}" style="display:inline">
              <button type="submit" class="btn btn-sm btn-success" title="–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å">‚ôªÔ∏è</button>
            </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <div class="empty-state">
      <div class="empty-icon">üì¶</div>
      <h3>–¢–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
      <p>{% if search %}–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å{% else %}–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä{% endif %}</p>
      <a href="/admin/products/add" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

